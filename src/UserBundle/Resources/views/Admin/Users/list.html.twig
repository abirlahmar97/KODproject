{% extends "UserBundle:Admin:layout.html.twig" %}

{% block main %}
    <!-- Breadcrumb -->
    <ol class="breadcrumb breadcrumb-2">
        <li><a href="{{ path('admin_homepage') }}"><i class="fa fa-home"></i>Home</a></li>
        <li class="active"><strong>Utilisateurs</strong></li>
    </ol>
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading clearfix">
                    <h4 class="panel-title">Liste des utilisateurs</h4>
                    <ul class="panel-tool-options">
                        <li><a href="{{ path('users_add') }}"><i class="fa fa-user-plus"></i> Ajouter</a></li>
                    </ul>
                </div>
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-hover dataTables-example" >
                            <thead>
                            <tr>
                                <th></th>
                                <th>Id</th>
                                <th>Email</th>
                                <th>Pseudo</th>
                                {#<th>Nom</th>#}
                                {#<th>Preom</th>#}
                                <th>Etat</th>
                                <th>Privilèges</th>
                                <th>Derniére connection</th>
                            </tr>
                            </thead>
                            <tbody>
                                {% for user in users %}
                                <tr class="gradeX">
                                    <td><input type="checkbox" name="{{ user.id }}"></td>
                                    <td>{{ user.id }}</td>
                                    <td>{{ user.email }}</td>
                                    <td>{{ user.username }}</td>
                                    <td>{{ user.enabled ? "Activé" : "Désactivé" }}</td>
                                    {% if user.roles[0] == "ROLE_ADMIN" %} <td>Admin</td>
                                    {% elseif user.roles[0] == "ROLE_SUPER_ADMIN" %} <td>Super admin</td>
                                    {% elseif user.roles[0] == "ROLE_PARENT" %} <td>Parent</td>
                                    {% elseif user.roles[0] == "ROLE_PROVIDER" %} <td>Fournisseur</td>
                                    {% else %} <td>{{  user.roles[0] }}</td>
                                    {% endif %}
                                    <td>{{ user.lastLogin | date('j F, Y H:i') }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="panel-footer">
                    <div class="row" style="margin-bottom: 0">
                        <div class="form-inline col-md-12">
                            <select class="form-control" id="action_blk">
                                <option value="0">Supprimer</option>
                                <option value="1">Désactiver</option>
                            </select>
                            <button class="btn btn-blue" id="action_ok">OK</button>
                            <label class="control-label" id="user_count"></label>
                        </div>
                    </div>
                </div>
                <form action="{{ path('users_blk_delete') }}" id="del_form" method="post">
                    <input type="hidden" class="users" name="users">
                </form>
                <form action="{{ path('users_blk_disable') }}" id="dis_form" method="post">
                    <input type="hidden" class="users" name="users">
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        $(function () {

            var users = [];
            $(':checkbox').change(function () {
                users = [];
                $(':checkbox:checked').each(function (i) {
                    users[i] = $(this).attr('name');
                });
                if(users.length > 0)
                    $('#user_count').text(users.length + " sélectionnés");
                else
                    $('#user_count').text("");
            });

            $('#action_ok').click(function (event) {
                event.preventDefault();
                console.log($('#action_blk').val());
                // $(':checkbox:checked').each(function (i) {
                //     users[i] = $(this).attr('name');
                // });
                // $('#users_del').val(users);
                // $('#del_form').submit();
            })
        })
    </script>
{% endblock %}